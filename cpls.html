for (var i = 0; i < str.length; i++) {
    if (str.charAt(i)==="b") {usecolor="yellow";}
	else if (str.charAt(i)==="g") {usecolor="white";}
	else if (str.charAt(i)==="r") {usecolor="red";}
	else if (str.charAt(i)==="o") {usecolor="orange";}
	else if (str.charAt(i)==="w") {usecolor="blue";}
	else if (str.charAt(i)==="y") {usecolor="green";}
	ctx.fillStyle = usecolor;
	ctx.fillRect(coords[(i+3*AUF)%12][0],coords[(i+3*AUF)%12][1],coords[(i+3*AUF)%12][2],coords[(i+3*AUF)%12][3]); 
}

<html><head><title>CPLS stolen from dipalma</title>
</head>
<body>
<script src="rippedfromdipalma.min.js"></script>
<center>
<canvas id="myCanvas" width="1100" height="450" style="border:0px solid #000000;">
</canvas>

<script>var imgToLoad = 6, imgLoaded = 0;
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
ctx.font = "60px Courier New";
ctx.fillText("CPLS Trainer",85,60);

ctx.font = "30px Courier New";
ctx.fillText("1",582,230);
ctx.fillText("3",762,230);
ctx.fillText("5",942,230);
ctx.fillText("2",582,390);
ctx.fillText("4",762,390);
ctx.fillText("6",942,390);





var img1 = new Image();
var img2 = new Image();
var img3 = new Image();
var img4 = new Image();
var img5 = new Image();
var img6 = new Image();
var img7 = new Image();
var img8 = new Image();
var alex1 = new Image();
var alex2 = new Image();
var alex3 = new Image();
var alex4 = new Image();
var alex5 = new Image();
var scr = new Image();

var use1=1;
var use2=1;
var use3=1;
var use4=1;
var use5=1;
var use6=1;

var attempts=0;
var corsofar=0;


var useAUFs=0;
var useALEX=0;
var colors = [
  ["w", "g", "o"],
  ["w", "o", "b"],
  ["w", "b", "r"],
  ["w", "r", "g"],
];
var correct=0;

img1.onload = function () {
    ctx.drawImage(img1, 530, 90);
	onImgLoad();
}
img1.src = "cpls1.png";
img3.onload = function () {
    ctx.drawImage(img3, 710, 90);
	onImgLoad();
}
img3.src = "cpls3.png";

img5.onload = function () {
    ctx.drawImage(img5, 890, 90);
	onImgLoad();
	OnImg
}
img5.src = "cpls5.png";

img2.onload = function () {
    ctx.drawImage(img2, 530, 250);
	onImgLoad();
}
img2.src = "cpls2.png";

img4.onload = function () {
    ctx.drawImage(img4, 710, 250);
	onImgLoad();
}
img4.src = "cpls4.png";

img6.onload = function () {
    ctx.drawImage(img6, 890, 250);
	onImgLoad();
}
img6.src = "cpls6.png";


 

function onImgLoad()
    {
        imgLoaded++;
        if(imgLoaded == imgToLoad)
            {startsquares();}
    };
	

function startsquares()
{
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.beginPath();
ctx.rect(535,95,110,110);
ctx.stroke();
ctx.beginPath();
ctx.rect(715,95,110,110);
ctx.stroke();
ctx.beginPath();
ctx.rect(895,95,110,110);
ctx.stroke();
ctx.beginPath();
ctx.rect(535,255,110,110);
ctx.stroke();
ctx.beginPath();
ctx.rect(715,255,110,110);
ctx.stroke();
ctx.beginPath();
ctx.rect(895,255,110,110);
ctx.stroke();
}


function redrawpics()
{
ctx.clearRect(500,80,600,370);
ctx.font = "30px Courier New";
ctx.fillText("1",582,230);
ctx.fillText("3",762,230);
ctx.fillText("5",942,230);
ctx.fillText("2",582,390);
ctx.fillText("4",762,390);
ctx.fillText("6",942,390);
ctx.drawImage(img1, 530, 90);
ctx.drawImage(img3, 710, 90);
ctx.drawImage(img5, 890, 90);
ctx.drawImage(img2, 530, 250);
ctx.drawImage(img4, 710, 250);
ctx.drawImage(img6, 890, 250);
if (use1==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(535,95,110,110);
ctx.stroke();
}
if (use3==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(715,95,110,110);
ctx.stroke();
}
if (use5==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(895,95,110,110);
ctx.stroke();
}
if (use2==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(535,255,110,110);
ctx.stroke();
}
if (use4==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(715,255,110,110);
ctx.stroke();
}
if (use6==1)
{
ctx.beginPath();
ctx.lineWidth="3";
ctx.strokeStyle="black";
ctx.rect(895,255,110,110);
ctx.stroke();
}

newScramble();

}


img7.src = "greencheck.png";
img8.src = "redx.png";

c.addEventListener('click', on_canvas_click, false);


function on_canvas_click(ev) {
    var x = ev.clientX - c.offsetLeft;
    var y = ev.clientY - c.offsetTop;
	
	//alert(x+" "+y);
	
	if (530<x && x<630 && 90<y && y<190)
	{
		use1=(use1+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use1=(use1+1)%2;alert("Error - at least one case must be selected");}
	}
	if (710<x && x<810 && 90<y && y<190)
	{
		use3=(use3+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use3=(use3+1)%2;alert("Error - at least one case must be selected");}
	}
	if (890<x && x<990 && 90<y && y<190)
	{
		use5=(use5+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use5=(use5+1)%2;alert("Error - at least one case must be selected");}
	}
	if (530<x && x<630 && 250<y && y<350)
	{
		use2=(use2+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use2=(use2+1)%2;alert("Error - at least one case must be selected");}
	}
	if (710<x && x<810 && 250<y && y<350)
	{
		use4=(use4+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use4=(use4+1)%2;alert("Error - at least one case must be selected");}
	}
	if (890<x && x<990 && 250<y && y<350)
	{
		use6=(use6+1)%2;
		if ((use1+use2+use3+use4+use5+use6)>0)
		{redrawpics();}
		else
		{use6=(use6+1)%2;alert("Error - at least one case must be selected");}
	}





}

alex1.src = "alexmorgan1.jpg";
alex2.src = "alexmorgan2.jpg";
alex3.src = "alexmorgan3.jpg";
alex4.src = "alexmorgan4.jpg";
alex5.src = "alexmorgan5.jpg";

function wrong(){
ctx.clearRect(100,225,50,50);
ctx.clearRect(450,225,50,50);
ctx.drawImage(img8, 100, 225,50,50);
ctx.drawImage(img8, 450, 225,50,50);
}

function right(){
ctx.clearRect(100,225,50,50);
ctx.clearRect(450,225,50,50);
ctx.drawImage(img7, 100, 225,50,38);
ctx.drawImage(img7, 450, 225,50,38);
}

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;
  while (0 !== currentIndex) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }
  return array;
}


function newdraw(str){
var coords=[
[168,292,88,88],
[168,382,88,30],
[138,292,30,88],
[168,118,88,88],
[138,118,30,88],
[168,88,88,30],
[342,118,88,88],
[342,88,88,30],
[432,118,30,88],
[342,292,88,88],
[432,292,30,88],
[342,382,88,30],
];

var usecolor="black";


ctx.fillStyle = "grey";
ctx.fillRect(168,118,264,264);

if (useALEX==1)
{
ctx.drawImage(alex1, 255, 205, 88, 88);
ctx.drawImage(alex2, 168, 205, 88, 88);
ctx.drawImage(alex3, 255, 118, 88, 88);
ctx.drawImage(alex4, 255, 292, 88, 88);
ctx.drawImage(alex5, 342, 205, 88, 88);
}


/*
ctx.fillRect(168,88,88,30);
ctx.fillRect(342,88,88,30);
ctx.fillRect(168,382,88,30);
ctx.fillRect(342,382,88,30);
ctx.fillRect(138,118,30,88);
ctx.fillRect(138,292,30,88);
ctx.fillRect(432,118,30,88);
ctx.fillRect(432,292,30,88);
*/

var AUF=0;
if (useAUFs==1)
{
AUF=Math.floor((Math.random()*4));
}


for (var i = 0; i < str.length; i++) {
    if (str.charAt(i)==="b") {usecolor="yellow";}
	else if (str.charAt(i)==="g") {usecolor="white";}
	else if (str.charAt(i)==="r") {usecolor="red";}
	else if (str.charAt(i)==="o") {usecolor="orange";}
	else if (str.charAt(i)==="w") {usecolor="blue";}
	else if (str.charAt(i)==="y") {usecolor="green";}
	ctx.fillStyle = usecolor;
	ctx.fillRect(coords[(i+3*AUF)%12][0],coords[(i+3*AUF)%12][1],coords[(i+3*AUF)%12][2],coords[(i+3*AUF)%12][3]); 
}

ctx.beginPath();
ctx.lineWidth = "6";
ctx.strokeStyle = "black";
ctx.rect(170, 120, 86, 86);  
ctx.rect(257, 120, 86, 86);  
ctx.rect(344, 120, 86, 86);  
ctx.rect(170, 207, 86, 86);  
ctx.rect(257, 207, 86, 86);  
ctx.rect(344, 207, 86, 86);  
ctx.rect(170, 294, 86, 86);  
ctx.rect(257, 294, 86, 86);  
ctx.rect(344, 294, 86, 86); 
ctx.rect(170, 90, 86, 30);  
ctx.rect(343, 90, 87, 30);   
ctx.rect(170, 380, 86, 30);  
ctx.rect(343, 380, 87, 30); 
ctx.rect(140, 120, 30, 86);  
ctx.rect(140, 293, 30, 87); 
ctx.rect(430, 120, 30, 86);  
ctx.rect(430, 293, 30, 87);
ctx.stroke();
ctx.fillStyle = "black";
}

function newScramble() 
{
var usable=0;
var tries=0;
	while (usable==0)
	{
	var cp=shuffle([0, 1, 2, 3]);
	
	
	if ((use6==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,1,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,2,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,3,0]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,0,1])))
		{usable=1;}
	else if ((use5==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,3,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,0,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,1,0]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,2,1])))
		{usable=1;}
	else if ((use4==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,1,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,2,0]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,3,1]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,0,2])))
		{usable=1;}
	else if ((use3==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,2,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,3,0]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,0,1]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,1,2])))
		{usable=1;}
	else if ((use2==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,3,1]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,0,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,1,3]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,2,0])))
		{usable=1;}
	else if ((use1==1)&&(JSON.stringify(cp.slice(0,3))===JSON.stringify([0,2,1]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,3,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,0,3]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,1,0])))
		{usable=1;}
	tries++;
	if (tries>100)
		{alert("Error - at least one case must be selected.");
		break;}
	
	}
	
	
	if (tries<=100)
	{

	var stringy="";
	for (var i=0; i<3; i++)
	{
		var orientation=Math.floor((Math.random()*3));
		stringy+=colors[cp[i]][orientation];
		stringy+=colors[cp[i]][(orientation+1)%3];
		stringy+=colors[cp[i]][(orientation+2)%3];
	}

	stringy+="yyy"
	
	if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,1,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,2,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,3,0]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,0,1]))
		{correct=6;}
	else if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,3,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,0,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,1,0]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,2,1]))
		{correct=5;}
	else if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,1,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,2,0]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,3,1]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,0,2]))
		{correct=4;}
	else if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,2,3]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,3,0]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,0,1]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,1,2]))
		{correct=3;}
	else if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,3,1]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,0,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,1,3]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,2,0]))
		{correct=2;}
	else if (JSON.stringify(cp.slice(0,3))===JSON.stringify([0,2,1]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([1,3,2]) || JSON.stringify(cp.slice(0,3))===JSON.stringify([2,0,3]) ||  JSON.stringify(cp.slice(0,3))===JSON.stringify([3,1,0]))
		{correct=1;}

	newdraw(stringy);

	}

}


function printaccuracy(bo) {
ctx.clearRect(510,45,1070,40);
ctx.font = "24px Courier New";
if (attempts==0)
{
ctx.fillText("Type the correct number.",600,65);
}
else
{
ctx.fillText("Attempts: "+attempts,537,65);
ctx.fillText("Accuracy: "+Number(100*corsofar/attempts).toFixed(2)+"%",770,65);
}
if (bo==1)
{
newScramble();
}
}


printaccuracy(1);


var listener = new window.keypress.Listener();

listener.simple_combo("1", function() {
if (correct!=0)
{
attempts+=1;
if (correct==1)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});

listener.simple_combo("2", function() {
if (correct!=0)
{
attempts+=1;
if (correct==2)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});

listener.simple_combo("3", function() {
if (correct!=0)
{
attempts+=1;
if (correct==3)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});

listener.simple_combo("4", function() {
if (correct!=0)
{
attempts+=1;
if (correct==4)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});

listener.simple_combo("5", function() {
if (correct!=0)
{
attempts+=1;
if (correct==5)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});

listener.simple_combo("6", function() {
if (correct!=0)
{
attempts+=1;
if (correct==6)
{
corsofar+=1;
right();
printaccuracy(1);
}
else{wrong();
printaccuracy(0);}
}
});




function AUFchanger(checkbox)
{
    if (checkbox.checked)
    {
        useAUFs=1;
    }
	if (!checkbox.checked)
    {
        useAUFs=0;
    }
		newScramble();
}

function ALEXchanger(checkbox)
{
    if (checkbox.checked)
    {
        useALEX=1;
    }
	if (!checkbox.checked)
    {
        useALEX=0;
    }
	newScramble();
}</script>
<p></p>
<table width="1100px" align="center" style="font-family: 'Courier New'">
<tbody><tr>
<td width="366px" align="center">
<input type="checkbox" onclick="AUFchanger(this)"> Allow AUF
</td><td width="366px" align="center">
<input type="checkbox" onclick="ALEXchanger(this)"> Moral Support
</td>
<td width="367px" align="center">
Click images to toggle cases.
</td>
</tr>
</tbody></table>
</center>


</body></html>
